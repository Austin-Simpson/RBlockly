<!-- MILESTONE 1 FILE -->

<!DOCTYPE html>
<html>
<head>
    <title>RBlock</title>
    <!-- Load Blockly -->
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="customs_blocks.js"></script>
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
    <div style="margin: 10px 0px 10px 5px">
        <a href="https://github.com/shmurthy08/RBlockly" target="_blank"><img src='https://cdn.jsdelivr.net/npm/simple-icons@3.0.1/icons/github.svg' alt='github' height='13'> View Source Code on GitHub</a>
    </div>
    <div style="display: flex; height: 95vh;">
        <!-- Left half (75% of screen width): Blockly workspace -->
        <div id="blocklyDiv" class="custom-blockly" style="flex: 3;"></div>

        <!-- Right half (25% of screen width): Display R code -->
        <div id="rCodeDisplay" style="flex: 1; height: 90%; overflow: auto; padding: 10px; display: none;"></div>
    </div>     

    <!-- "Generate R" button outside of Blockly workspace -->
    <button type="button" onclick="updateRCode()" class="action-button" style="left: 9px;">Generate R</button>
    <!-- "Download" button placed outside of Blockly workspace -->
    <button type="button" onclick="download()" class="action-button" style="left: 97px;">Download</button>

    <script>
        var workspace;
        var rCodeVisible = false;

        // Wait for the Blockly library to load before creating the workspace
        document.addEventListener("DOMContentLoaded", function () {
            // Empty block definition
            // Blockly.defineBlocksWithJsonArray([
            //     {
            //         "type": "empty_block",
            //         "message0": "%1",
            //         "args0": [
            //         {
            //             "type": "field_number",
            //             "name": "NUM",
            //             "value": 0
            //         }
            //         ],
            //         "output": "Number",
            //         "inputsInline": false, // Disallow inline connections
            //         "previousStatement": null, // No previous connections
            //         "nextStatement": null, 
            //         "colour": 90,
            //         "tooltip": "Add a number",
            //         "helpUrl": ""
            //     }
            // ]);

            // Initialize block definition
            Blockly.defineBlocksWithJsonArray([
                {
                    "type": "r_variable",
                    "message0": "%1 <- %2",
                    "args0": [
                    {
                        "type": "field_input",
                        "name": "VAR_NAME",
                        "text": "variable_name"
                    },
                    {
                        "type": "field_input",
                        "name": "INITIAL_VALUE",
                        "text": "initial_value"
                    }
                    ],
                    "output": "Variable",
                    "inputsInline": true,
                    "previousStatement": null,
                    // "nextStatement": null,
                    "colour": 270,
                    "tooltip": "Initialize a variable in R",
                    "helpUrl": ""
                }
            ]);

            // Initialize list definition
            Blockly.defineBlocksWithJsonArray([
                {
                    "type": "initialize_list",
                    "message0": "%1 <- c(%2)",
                    "args0": [
                        {
                            "type": "field_input",
                            "name": "LIST_NAME",
                            "text": "list_name" 
                        },
                        {
                            "type": "field_input",
                            "name": "NUMBERS",
                            "text": "num1, num2, num3" 
                        }
                    ],
                    "output": "Array",
                    "inputsInline": true,
                    "previousStatement": null,
                    // "nextStatement": null,
                    "colour": 210,
                    "tooltip": "Initialize a list in R",
                    "helpUrl": ""
                }
            ]);

            // Mean block definition
            Blockly.defineBlocksWithJsonArray([
                {
                    "type": "calculate_mean",
                    "message0": "Mean %1 of %2",
                    "args0": [
                        {
                            "type": "field_input",
                            "name": "VAR_NAME",
                            "text": "var_name"
                        },
                        {
                            "type": "input_statement",
                            "name": "LIST_NAME",
                            "text": "list",
                            "check": "Array" 
                        }
                    ],
                    "output": "Number",
                    // "previousStatement": null,
                    // "nextStatement": null,
                    "colour": 180,
                    "tooltip": "Calculate the mean of a list in R",
                    "helpUrl": ""
                }
            ]);

            // Median block definition
            Blockly.defineBlocksWithJsonArray([
                {
                    "type": "calculate_median",
                    "message0": "Median %1 of %2",
                    "args0": [
                        {
                            "type": "field_input",
                            "name": "VAR_NAME",
                            "text": "var_name"
                        },
                        {
                            "type": "input_statement",
                            "name": "LIST_NAME",
                            "text": "list",
                            "check": "Array" 
                        }
                    ],
                    "output": "Number",
                    // "previousStatement": null,
                    // "nextStatement": null,
                    "colour": 180,
                    "tooltip": "Calculate the median of a list in R",
                    "helpUrl": ""
                }
            ]);

            // Mode block definition
            Blockly.defineBlocksWithJsonArray([
                {
                    "type": "calculate_mode",
                    "message0": "Mode %1 of %2",
                    "args0": [
                        {
                            "type": "field_input",
                            "name": "VAR_NAME",
                            "text": "var_name"
                        },
                        {
                            "type": "input_statement",
                            "name": "LIST_NAME",
                            "text": "list",
                            "check": "Array" 
                        }
                    ],
                    "output": "Number",
                    // "previousStatement": null,
                    // "nextStatement": null,
                    "colour": 180,
                    "tooltip": "Calculate the mode of a list in R"
                }
            ]);

            // Range block definition
            Blockly.defineBlocksWithJsonArray([
                {
                    "type": "calculate_range",
                    "message0": "Range %1 of %2",
                    "args0": [
                        {
                            "type": "field_input",
                            "name": "VAR_NAME",
                            "text": "var_name"
                        },
                        {
                            "type": "input_statement",
                            "name": "LIST_NAME",
                            "text": "list",
                            "check": "Array" 
                        }
                    ],
                    "output": "Number",
                    // "previousStatement": null,
                    // "nextStatement": null,
                    "colour": 180,
                    "tooltip": "Calculate range of a list in R"
                }
            ]);

            // Create blockly workspace
            workspace = Blockly.inject('blocklyDiv', {
                media: 'https://unpkg.com/blockly@5.1.0/media/',
                toolbox: '<xml id="toolbox" style="display: none"></block><block type="r_variable"></block><block type="initialize_list"></block><block type="calculate_mean"></block><block type="calculate_median"></block><block type="calculate_mode"></block><block type="calculate_range"></block></xml>'
            });
        });
    </script>
</body>
</html>